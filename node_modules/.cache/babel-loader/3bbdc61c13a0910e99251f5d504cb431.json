{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/runner/work/watchparty/watchparty/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useState}from'react';import{Button,Icon,Popup}from'semantic-ui-react';import{serverPath}from'../../utils';import{SubscribeModal}from'../Modal/SubscribeModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var SubscribeButton=function SubscribeButton(_ref){var user=_ref.user,isSubscriber=_ref.isSubscriber,isCustomer=_ref.isCustomer;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isSubscribeModalOpen=_useState2[0],setIsSubscribeModalOpen=_useState2[1];var onManage=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var resp,session;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=window;_context.t1=serverPath+'/manageSub';_context.t2={'Content-Type':'application/json'};_context.t3=JSON;_context.t4=user===null||user===void 0?void 0:user.uid;_context.next=7;return user===null||user===void 0?void 0:user.getIdToken();case 7:_context.t5=_context.sent;_context.t6=window.location.href;_context.t7={uid:_context.t4,token:_context.t5,return_url:_context.t6};_context.t8=_context.t3.stringify.call(_context.t3,_context.t7);_context.t9={method:'POST',headers:_context.t2,body:_context.t8};_context.next=14;return _context.t0.fetch.call(_context.t0,_context.t1,_context.t9);case 14:resp=_context.sent;_context.next=17;return resp.json();case 17:session=_context.sent;console.log(session);window.location.assign(session.url);case 20:case\"end\":return _context.stop();}}},_callee);})),[user]);return/*#__PURE__*/_jsxs(_Fragment,{children:[isSubscribeModalOpen&&/*#__PURE__*/_jsx(SubscribeModal,{user:user,isSubscriber:isSubscriber,closeSubscribe:function closeSubscribe(){return setIsSubscribeModalOpen(false);}}),!isSubscriber&&/*#__PURE__*/_jsx(Popup,{content:\"Subscribe to help support us and enable additional features!\",trigger:/*#__PURE__*/_jsxs(Button,{fluid:true,color:\"orange\",className:\"toolButton\",icon:true,labelPosition:\"left\",onClick:function onClick(){return setIsSubscribeModalOpen(true);},children:[/*#__PURE__*/_jsx(Icon,{name:\"plus\"}),\"Subscribe\"]})}),isSubscriber&&/*#__PURE__*/_jsx(Popup,{content:\"Manage your subscription\",trigger:/*#__PURE__*/_jsxs(Button,{fluid:true,color:\"orange\",className:\"toolButton\",icon:true,labelPosition:\"left\",onClick:onManage,children:[/*#__PURE__*/_jsx(Icon,{name:\"wrench\"}),\"Manage\"]})})]});};","map":{"version":3,"sources":["/home/runner/work/watchparty/watchparty/src/components/SubscribeButton/SubscribeButton.tsx"],"names":["React","useCallback","useState","Button","Icon","Popup","serverPath","SubscribeModal","SubscribeButton","user","isSubscriber","isCustomer","isSubscribeModalOpen","setIsSubscribeModalOpen","onManage","window","JSON","uid","getIdToken","location","href","token","return_url","stringify","method","headers","body","fetch","resp","json","session","console","log","assign","url"],"mappings":"udAAA,MAAOA,CAAAA,KAAP,EAAgBC,WAAhB,CAA6BC,QAA7B,KAA6C,OAA7C,CACA,OAASC,MAAT,CAAiBC,IAAjB,CAAuBC,KAAvB,KAAoC,mBAApC,CACA,OAASC,UAAT,KAA2B,aAA3B,CACA,OAASC,cAAT,KAA+B,yBAA/B,C,6IAGA,MAAO,IAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,MAQzB,IAPJC,CAAAA,IAOI,MAPJA,IAOI,CANJC,YAMI,MANJA,YAMI,CALJC,UAKI,MALJA,UAKI,CACJ,cAAwDT,QAAQ,CAAC,KAAD,CAAhE,wCAAOU,oBAAP,eAA6BC,uBAA7B,eACA,GAAMC,CAAAA,QAAQ,CAAGb,WAAW,sEAAC,gKACRc,MADQ,aACKT,UAAU,CAAG,YADlB,aAGhB,CACP,eAAgB,kBADT,CAHgB,aAMnBU,IANmB,aAOlBP,IAPkB,SAOlBA,IAPkB,iBAOlBA,IAAI,CAAEQ,GAPY,uBAQVR,CAAAA,IARU,SAQVA,IARU,iBAQVA,IAAI,CAAES,UAAN,EARU,8CASXH,MAAM,CAACI,QAAP,CAAgBC,IATL,cAOvBH,GAPuB,aAQvBI,KARuB,aASvBC,UATuB,sCAMdC,SANc,4CAEzBC,MAFyB,CAEjB,MAFiB,CAGzBC,OAHyB,aAMzBC,IANyB,kDACDC,KADC,mDACrBC,IADqB,sCAYLA,CAAAA,IAAI,CAACC,IAAL,EAZK,SAYrBC,OAZqB,eAa3BC,OAAO,CAACC,GAAR,CAAYF,OAAZ,EACAf,MAAM,CAACI,QAAP,CAAgBc,MAAhB,CAAuBH,OAAO,CAACI,GAA/B,EAd2B,uDAAD,GAezB,CAACzB,IAAD,CAfyB,CAA5B,CAgBA,mBACE,2BACGG,oBAAoB,eACnB,KAAC,cAAD,EACE,IAAI,CAAEH,IADR,CAEE,YAAY,CAAEC,YAFhB,CAGE,cAAc,CAAE,gCAAMG,CAAAA,uBAAuB,CAAC,KAAD,CAA7B,EAHlB,EAFJ,CAQG,CAACH,YAAD,eACC,KAAC,KAAD,EACE,OAAO,CAAC,8DADV,CAEE,OAAO,cACL,MAAC,MAAD,EACE,KAAK,KADP,CAEE,KAAK,CAAC,QAFR,CAGE,SAAS,CAAC,YAHZ,CAIE,IAAI,KAJN,CAKE,aAAa,CAAC,MALhB,CAME,OAAO,CAAE,yBAAMG,CAAAA,uBAAuB,CAAC,IAAD,CAA7B,EANX,wBAQE,KAAC,IAAD,EAAM,IAAI,CAAC,MAAX,EARF,eAHJ,EATJ,CA0BGH,YAAY,eACX,KAAC,KAAD,EACE,OAAO,CAAC,0BADV,CAEE,OAAO,cACL,MAAC,MAAD,EACE,KAAK,KADP,CAEE,KAAK,CAAC,QAFR,CAGE,SAAS,CAAC,YAHZ,CAIE,IAAI,KAJN,CAKE,aAAa,CAAC,MALhB,CAME,OAAO,CAAEI,QANX,wBAQE,KAAC,IAAD,EAAM,IAAI,CAAC,QAAX,EARF,YAHJ,EA3BJ,GADF,CA+CD,CAzEM","sourcesContent":["import React, { useCallback, useState } from 'react';\nimport { Button, Icon, Popup } from 'semantic-ui-react';\nimport { serverPath } from '../../utils';\nimport { SubscribeModal } from '../Modal/SubscribeModal';\nimport firebase from 'firebase/compat/app';\n\nexport const SubscribeButton = ({\n  user,\n  isSubscriber,\n  isCustomer,\n}: {\n  user: firebase.User | undefined;\n  isSubscriber: boolean;\n  isCustomer: boolean;\n}) => {\n  const [isSubscribeModalOpen, setIsSubscribeModalOpen] = useState(false);\n  const onManage = useCallback(async () => {\n    const resp = await window.fetch(serverPath + '/manageSub', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        uid: user?.uid,\n        token: await user?.getIdToken(),\n        return_url: window.location.href,\n      }),\n    });\n    const session = await resp.json();\n    console.log(session);\n    window.location.assign(session.url);\n  }, [user]);\n  return (\n    <>\n      {isSubscribeModalOpen && (\n        <SubscribeModal\n          user={user}\n          isSubscriber={isSubscriber}\n          closeSubscribe={() => setIsSubscribeModalOpen(false)}\n        />\n      )}\n      {!isSubscriber && (\n        <Popup\n          content=\"Subscribe to help support us and enable additional features!\"\n          trigger={\n            <Button\n              fluid\n              color=\"orange\"\n              className=\"toolButton\"\n              icon\n              labelPosition=\"left\"\n              onClick={() => setIsSubscribeModalOpen(true)}\n            >\n              <Icon name=\"plus\" />\n              Subscribe\n            </Button>\n          }\n        />\n      )}\n      {isSubscriber && (\n        <Popup\n          content=\"Manage your subscription\"\n          trigger={\n            <Button\n              fluid\n              color=\"orange\"\n              className=\"toolButton\"\n              icon\n              labelPosition=\"left\"\n              onClick={onManage}\n            >\n              <Icon name=\"wrench\" />\n              Manage\n            </Button>\n          }\n        />\n      )}\n    </>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}