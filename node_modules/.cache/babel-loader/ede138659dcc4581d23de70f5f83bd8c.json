{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";//@ts-ignore\nimport canAutoplay from'can-autoplay';import{parseStringPromise}from'xml2js';import{v4 as uuidv4}from'uuid';import md5 from'blueimp-md5';export function formatTimestamp(input){if(input===null||input===undefined||input===false||Number.isNaN(input)||input===Infinity){return'';}var hours=Math.floor(Number(input)/3600);var minutes=(Math.floor(Number(input)/60)%60).toString().padStart(2,'0');var seconds=Math.floor(Number(input)%60).toString().padStart(2,'0');return\"\".concat(hours,\":\").concat(minutes,\":\").concat(seconds);}export function formatSpeed(input){if(input>=1000000){return(input/1000000).toFixed(2)+' MiB/s';}if(input>=1000){return(input/1000).toFixed(0)+' KiB/s';}return input+' B/s';}export function hashString(input){var hash=0;for(var i=0;i<input.length;i++){var charCode=input.charCodeAt(i);hash+=charCode;}return hash;}export var colorMappings={red:'B03060',orange:'FE9A76',yellow:'FFD700',olive:'32CD32',green:'016936',teal:'008080',blue:'0E6EB8',violet:'EE82EE',purple:'B413EC',pink:'FF1493',brown:'A52A2A',grey:'A0A0A0',black:'000000'};var colorCache={};export function getColorForString(id){var colors=['red','orange','yellow','olive','green','teal','blue','violet','purple','pink','brown','grey'];if(colorCache[id]){return colors[colorCache[id]];}colorCache[id]=Math.abs(hashString(id))%colors.length;return colors[colorCache[id]];}export function getColorForStringHex(id){return colorMappings[getColorForString(id)];}export var getFbPhoto=function getFbPhoto(fbId){return\"https://graph.facebook.com/\".concat(fbId,\"/picture?type=normal\");};export var getMediaType=function getMediaType(input){if(!input){return'';}if(input.startsWith('https://www.youtube.com/')||input.startsWith('https://youtu.be/')){return'youtube';}return'video';};export function testAutoplay(){return _testAutoplay.apply(this,arguments);}function _testAutoplay(){_testAutoplay=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return canAutoplay.video();case 2:result=_context.sent;return _context.abrupt(\"return\",result.result);case 4:case\"end\":return _context.stop();}}},_callee);}));return _testAutoplay.apply(this,arguments);}export function decodeEntities(input){var doc=new DOMParser().parseFromString(input,'text/html');return doc.documentElement.textContent;}// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the function on the\n// leading edge, instead of the trailing.\nexport function debounce(func,wait,immediate){var timeout;// This is the function that is actually executed when\n// the DOM event is triggered.\nreturn function executedFunction(){// Store the context of this and any\n// parameters passed to executedFunction\n//@ts-ignore\nvar context=this;var args=arguments;// The function to be called after\n// the debounce time has elapsed\nvar later=function later(){// null timeout to indicate the debounce ended\ntimeout=null;// Call function now if you did not on the leading end\nif(!immediate)func.apply(context,args);};// Determine if you should call the function\n// on the leading or trail end\nvar callNow=immediate&&!timeout;// This will reset the waiting every function execution.\n// This is the step that prevents the function from\n// being executed because it will never reach the\n// inside of the previous setTimeout\nclearTimeout(timeout);// Restart the debounce waiting period.\n// setTimeout returns a truthy value (it differs in web vs node)\ntimeout=setTimeout(later,wait);// Call immediately if you're dong a leading\n// end execution\nif(callNow)func.apply(context,args);};}export var getMediaPathForList=function getMediaPathForList(list){if(list.startsWith('https://gitlab.com/')){var match=list.match(/https:\\/\\/gitlab.com\\/api\\/v4\\/projects\\/(.*)\\/repository\\/tree/);var name=match&&match[1];var decoded=decodeURIComponent(name||'');return\"https://glcdn.githack.com/\".concat(decoded,\"/-/raw/master/\");}// Nginx servers use the same mediapath as list, add trailing /\nreturn list+'/';};export var getDefaultPicture=function getDefaultPicture(name){var background=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'a0a0a0';return\"https://ui-avatars.com/api/?name=\".concat(name,\"&background=\").concat(background,\"&size=256&color=ffffff\");};export var isMobile=function isMobile(){return window.screen.width<=600;};export function shuffle(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*i);var temp=array[i];array[i]=array[j];array[j]=temp;}}export var iceServers=function iceServers(){return[{urls:'stun:stun.l.google.com:19302'},{urls:'turn:5.161.49.183:3478',username:'username',credential:'password'},{urls:'turn:135.181.147.65:3478',username:'username',credential:'password'},{urls:'turn:numb.viagenie.ca',credential:'watchparty',username:'howardzchung@gmail.com'}];};export var serverPath=process.env.REACT_APP_SERVER_HOST||\"\".concat(window.location.protocol,\"//\").concat(process.env.NODE_ENV==='production'?window.location.host:\"\".concat(window.location.hostname,\":8080\"));export function getMediaPathResults(_x,_x2){return _getMediaPathResults.apply(this,arguments);}function _getMediaPathResults(){_getMediaPathResults=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(mediaPath,query){var response,results,xml,data,filtered,_data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return window.fetch(mediaPath);case 2:response=_context2.sent;results=[];if(!mediaPath.includes('s3.')){_context2.next=15;break;}_context2.next=7;return response.text();case 7:xml=_context2.sent;_context2.next=10;return parseStringPromise(xml);case 10:data=_context2.sent;filtered=data.ListBucketResult.Contents.filter(function(file){return!file.Key[0].includes('/');});results=filtered.map(function(file){return{url:mediaPath+'/'+file.Key[0],name:mediaPath+'/'+file.Key[0]};});_context2.next=19;break;case 15:_context2.next=17;return response.json();case 17:_data=_context2.sent;results=_data.filter(function(file){return file.type==='file';}).map(function(file){return{url:file.url||getMediaPathForList(mediaPath)+file.name,name:getMediaPathForList(mediaPath)+file.name};});case 19:results=results.filter(function(option){return option.name.toLowerCase().includes(query.toLowerCase());});return _context2.abrupt(\"return\",results);case 21:case\"end\":return _context2.stop();}}},_callee2);}));return _getMediaPathResults.apply(this,arguments);}export function getStreamPathResults(_x3,_x4){return _getStreamPathResults.apply(this,arguments);}function _getStreamPathResults(){_getStreamPathResults=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(streamPath,query){var response,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return window.fetch(streamPath+'/search?q='+encodeURIComponent(query));case 2:response=_context3.sent;_context3.next=5;return response.json();case 5:data=_context3.sent;return _context3.abrupt(\"return\",data);case 7:case\"end\":return _context3.stop();}}},_callee3);}));return _getStreamPathResults.apply(this,arguments);}export function getYouTubeResults(_x5){return _getYouTubeResults.apply(this,arguments);}function _getYouTubeResults(){_getYouTubeResults=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(query){var response,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return window.fetch(serverPath+'/youtube?q='+encodeURIComponent(query));case 2:response=_context4.sent;_context4.next=5;return response.json();case 5:data=_context4.sent;return _context4.abrupt(\"return\",data);case 7:case\"end\":return _context4.stop();}}},_callee4);}));return _getYouTubeResults.apply(this,arguments);}export function openFileSelector(_x6){return _openFileSelector.apply(this,arguments);}function _openFileSelector(){_openFileSelector=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(accept){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",new Promise(function(resolve){// Create an input element\nvar inputElement=document.createElement('input');// Set its type to file\n// Set its type to file\ninputElement.type='file';// Set accept to the file types you want the user to select.\n// Include both the file extension and the mime type\n// Set accept to the file types you want the user to select.\n// Include both the file extension and the mime type\nif(accept){inputElement.accept=accept;}// set onchange event to call callback when user has selected file\n// set onchange event to call callback when user has selected file\ninputElement.addEventListener('change',function(){resolve(inputElement.files);});// dispatch a click event to open the file dialog\n// dispatch a click event to open the file dialog\ninputElement.dispatchEvent(new MouseEvent('click'));}));case 1:case\"end\":return _context5.stop();}}},_callee5);}));return _openFileSelector.apply(this,arguments);}export function getAndSaveClientId(){var clientId=window.localStorage.getItem('watchparty-clientid');if(!clientId){// Generate a new clientID and save it\nclientId=uuidv4();window.localStorage.setItem('watchparty-clientid',clientId);}return clientId;}export function calculateMedian(array){// Check If Data Exists\nif(array.length>=1){// Sort Array\narray=array.sort(function(a,b){return a-b;});// Array Length: Even\nif(array.length%2===0){// Average Of Two Middle Numbers\nreturn(array[array.length/2-1]+array[array.length/2])/2;}// Array Length: Odd\nelse{// Middle Number\nreturn array[(array.length-1)/2];}}return 0;}export function getUserImage(_x7){return _getUserImage.apply(this,arguments);}function _getUserImage(){_getUserImage=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(user){var hash,gravatar,response;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:// Check if user has a Gravatar\nhash=user.email?md5(user.email):'';if(!user.email){_context6.next=8;break;}gravatar=\"https://www.gravatar.com/avatar/\".concat(hash,\"?d=404&s=256\");_context6.next=5;return window.fetch(gravatar);case 5:response=_context6.sent;if(!response.ok){_context6.next=8;break;}return _context6.abrupt(\"return\",gravatar);case 8:if(!user.photoURL){_context6.next=10;break;}return _context6.abrupt(\"return\",user.photoURL+'?height=256&width=256');case 10:return _context6.abrupt(\"return\",\"https://www.gravatar.com/avatar/\".concat(hash,\"?d=identicon\"));case 11:case\"end\":return _context6.stop();}}},_callee6);}));return _getUserImage.apply(this,arguments);}","map":{"version":3,"sources":["/home/runner/work/watchparty/watchparty/src/utils/index.ts"],"names":["canAutoplay","parseStringPromise","v4","uuidv4","md5","formatTimestamp","input","undefined","Number","isNaN","Infinity","hours","Math","floor","minutes","toString","padStart","seconds","formatSpeed","toFixed","hashString","hash","i","length","charCode","charCodeAt","colorMappings","red","orange","yellow","olive","green","teal","blue","violet","purple","pink","brown","grey","black","colorCache","getColorForString","id","colors","abs","getColorForStringHex","getFbPhoto","fbId","getMediaType","startsWith","testAutoplay","video","result","decodeEntities","doc","DOMParser","parseFromString","documentElement","textContent","debounce","func","wait","immediate","timeout","executedFunction","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","getMediaPathForList","list","match","name","decoded","decodeURIComponent","getDefaultPicture","background","isMobile","window","screen","width","shuffle","array","j","random","temp","iceServers","urls","username","credential","serverPath","process","env","REACT_APP_SERVER_HOST","location","protocol","NODE_ENV","host","hostname","getMediaPathResults","mediaPath","query","fetch","response","results","includes","text","xml","data","filtered","ListBucketResult","Contents","filter","file","Key","map","url","json","type","option","toLowerCase","getStreamPathResults","streamPath","encodeURIComponent","getYouTubeResults","openFileSelector","accept","Promise","resolve","inputElement","document","createElement","addEventListener","files","dispatchEvent","MouseEvent","getAndSaveClientId","clientId","localStorage","getItem","setItem","calculateMedian","sort","a","b","getUserImage","user","email","gravatar","ok","photoURL"],"mappings":"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","sourcesContent":["//@ts-ignore\nimport canAutoplay from 'can-autoplay';\nimport { parseStringPromise } from 'xml2js';\nimport { v4 as uuidv4 } from 'uuid';\nimport md5 from 'blueimp-md5';\nimport firebase from 'firebase/compat/app';\n\nexport function formatTimestamp(input: any) {\n  if (\n    input === null ||\n    input === undefined ||\n    input === false ||\n    Number.isNaN(input) ||\n    input === Infinity\n  ) {\n    return '';\n  }\n  let hours = Math.floor(Number(input) / 3600);\n  let minutes = (Math.floor(Number(input) / 60) % 60)\n    .toString()\n    .padStart(2, '0');\n  let seconds = Math.floor(Number(input) % 60)\n    .toString()\n    .padStart(2, '0');\n  return `${hours}:${minutes}:${seconds}`;\n}\n\nexport function formatSpeed(input: number) {\n  if (input >= 1000000) {\n    return (input / 1000000).toFixed(2) + ' MiB/s';\n  }\n  if (input >= 1000) {\n    return (input / 1000).toFixed(0) + ' KiB/s';\n  }\n  return input + ' B/s';\n}\n\nexport function hashString(input: string) {\n  var hash = 0;\n  for (var i = 0; i < input.length; i++) {\n    var charCode = input.charCodeAt(i);\n    hash += charCode;\n  }\n  return hash;\n}\n\nexport const colorMappings: StringDict = {\n  red: 'B03060',\n  orange: 'FE9A76',\n  yellow: 'FFD700',\n  olive: '32CD32',\n  green: '016936',\n  teal: '008080',\n  blue: '0E6EB8',\n  violet: 'EE82EE',\n  purple: 'B413EC',\n  pink: 'FF1493',\n  brown: 'A52A2A',\n  grey: 'A0A0A0',\n  black: '000000',\n};\n\nlet colorCache = {} as NumberDict;\nexport function getColorForString(id: string) {\n  let colors = [\n    'red',\n    'orange',\n    'yellow',\n    'olive',\n    'green',\n    'teal',\n    'blue',\n    'violet',\n    'purple',\n    'pink',\n    'brown',\n    'grey',\n  ];\n  if (colorCache[id]) {\n    return colors[colorCache[id]];\n  }\n  colorCache[id] = Math.abs(hashString(id)) % colors.length;\n  return colors[colorCache[id]];\n}\n\nexport function getColorForStringHex(id: string) {\n  return colorMappings[getColorForString(id)];\n}\n\nexport const getFbPhoto = (fbId: string) =>\n  `https://graph.facebook.com/${fbId}/picture?type=normal`;\n\nexport const getMediaType = (input: string) => {\n  if (!input) {\n    return '';\n  }\n  if (\n    input.startsWith('https://www.youtube.com/') ||\n    input.startsWith('https://youtu.be/')\n  ) {\n    return 'youtube';\n  }\n  return 'video';\n};\n\nexport async function testAutoplay() {\n  const result = await canAutoplay.video();\n  return result.result;\n}\n\nexport function decodeEntities(input: string) {\n  const doc = new DOMParser().parseFromString(input, 'text/html');\n  return doc.documentElement.textContent;\n}\n\n// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the function on the\n// leading edge, instead of the trailing.\nexport function debounce(func: Function, wait: number, immediate?: boolean) {\n  var timeout: any;\n\n  // This is the function that is actually executed when\n  // the DOM event is triggered.\n  return function executedFunction() {\n    // Store the context of this and any\n    // parameters passed to executedFunction\n    //@ts-ignore\n    var context = this;\n    var args = arguments;\n\n    // The function to be called after\n    // the debounce time has elapsed\n    var later = function () {\n      // null timeout to indicate the debounce ended\n      timeout = null;\n\n      // Call function now if you did not on the leading end\n      if (!immediate) func.apply(context, args);\n    };\n\n    // Determine if you should call the function\n    // on the leading or trail end\n    var callNow = immediate && !timeout;\n\n    // This will reset the waiting every function execution.\n    // This is the step that prevents the function from\n    // being executed because it will never reach the\n    // inside of the previous setTimeout\n    clearTimeout(timeout);\n\n    // Restart the debounce waiting period.\n    // setTimeout returns a truthy value (it differs in web vs node)\n    timeout = setTimeout(later, wait);\n\n    // Call immediately if you're dong a leading\n    // end execution\n    if (callNow) func.apply(context, args);\n  };\n}\n\nexport const getMediaPathForList = (list: string) => {\n  if (list.startsWith('https://gitlab.com/')) {\n    const match = list.match(\n      /https:\\/\\/gitlab.com\\/api\\/v4\\/projects\\/(.*)\\/repository\\/tree/\n    );\n    const name = match && match[1];\n    const decoded = decodeURIComponent(name || '');\n    return `https://glcdn.githack.com/${decoded}/-/raw/master/`;\n  }\n  // Nginx servers use the same mediapath as list, add trailing /\n  return list + '/';\n};\n\nexport const getDefaultPicture = (name: string, background = 'a0a0a0') => {\n  return `https://ui-avatars.com/api/?name=${name}&background=${background}&size=256&color=ffffff`;\n};\n\nexport const isMobile = () => {\n  return window.screen.width <= 600;\n};\n\nexport function shuffle(array: any[]) {\n  for (let i = array.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * i);\n    const temp = array[i];\n    array[i] = array[j];\n    array[j] = temp;\n  }\n}\n\nexport const iceServers = () => [\n  { urls: 'stun:stun.l.google.com:19302' },\n  {\n    urls: 'turn:5.161.49.183:3478',\n    username: 'username',\n    credential: 'password',\n  },\n  {\n    urls: 'turn:135.181.147.65:3478',\n    username: 'username',\n    credential: 'password',\n  },\n  {\n    urls: 'turn:numb.viagenie.ca',\n    credential: 'watchparty',\n    username: 'howardzchung@gmail.com',\n  },\n];\n\nexport const serverPath =\n  process.env.REACT_APP_SERVER_HOST ||\n  `${window.location.protocol}//${\n    process.env.NODE_ENV === 'production'\n      ? window.location.host\n      : `${window.location.hostname}:8080`\n  }`;\n\nexport async function getMediaPathResults(\n  mediaPath: string,\n  query: string\n): Promise<SearchResult[]> {\n  // Get media list if provided\n  const response = await window.fetch(mediaPath);\n  let results: SearchResult[] = [];\n  if (mediaPath.includes('s3.')) {\n    // S3-style buckets return data in XML\n    const xml = await response.text();\n    const data = await parseStringPromise(xml);\n    let filtered = data.ListBucketResult.Contents.filter(\n      (file: any) => !file.Key[0].includes('/')\n    );\n    results = filtered.map((file: any) => ({\n      url: mediaPath + '/' + file.Key[0],\n      name: mediaPath + '/' + file.Key[0],\n    }));\n  } else {\n    const data = await response.json();\n    results = data\n      .filter((file: any) => file.type === 'file')\n      .map((file: any) => ({\n        url: file.url || getMediaPathForList(mediaPath) + file.name,\n        name: getMediaPathForList(mediaPath) + file.name,\n      }));\n  }\n  results = results.filter((option: SearchResult) =>\n    option.name.toLowerCase().includes(query.toLowerCase())\n  );\n  return results;\n}\n\nexport async function getStreamPathResults(\n  streamPath: string,\n  query: string\n): Promise<SearchResult[]> {\n  const response = await window.fetch(\n    streamPath + '/search?q=' + encodeURIComponent(query)\n  );\n  const data = await response.json();\n  return data;\n}\n\nexport async function getYouTubeResults(\n  query: string\n): Promise<SearchResult[]> {\n  const response = await window.fetch(\n    serverPath + '/youtube?q=' + encodeURIComponent(query)\n  );\n  const data = await response.json();\n  return data;\n}\n\nexport async function openFileSelector(accept?: string) {\n  return new Promise<FileList | null>((resolve) => {\n    // Create an input element\n    const inputElement = document.createElement('input');\n\n    // Set its type to file\n    inputElement.type = 'file';\n\n    // Set accept to the file types you want the user to select.\n    // Include both the file extension and the mime type\n    if (accept) {\n      inputElement.accept = accept;\n    }\n\n    // set onchange event to call callback when user has selected file\n    inputElement.addEventListener('change', () => {\n      resolve(inputElement.files);\n    });\n\n    // dispatch a click event to open the file dialog\n    inputElement.dispatchEvent(new MouseEvent('click'));\n  });\n}\n\nexport function getAndSaveClientId() {\n  let clientId = window.localStorage.getItem('watchparty-clientid');\n  if (!clientId) {\n    // Generate a new clientID and save it\n    clientId = uuidv4();\n    window.localStorage.setItem('watchparty-clientid', clientId);\n  }\n  return clientId;\n}\n\nexport function calculateMedian(array: Array<number>): number {\n  // Check If Data Exists\n  if (array.length >= 1) {\n    // Sort Array\n    array = array.sort((a: number, b: number) => {\n      return a - b;\n    });\n\n    // Array Length: Even\n    if (array.length % 2 === 0) {\n      // Average Of Two Middle Numbers\n      return (array[array.length / 2 - 1] + array[array.length / 2]) / 2;\n    }\n    // Array Length: Odd\n    else {\n      // Middle Number\n      return array[(array.length - 1) / 2];\n    }\n  }\n  return 0;\n}\n\nexport async function getUserImage(\n  user: firebase.User\n): Promise<string | null> {\n  // Check if user has a Gravatar\n  const hash = user.email ? md5(user.email) : '';\n  if (user.email) {\n    const gravatar = `https://www.gravatar.com/avatar/${hash}?d=404&s=256`;\n    const response = await window.fetch(gravatar);\n    if (response.ok) {\n      return gravatar;\n    }\n  }\n  if (user.photoURL) {\n    return user.photoURL + '?height=256&width=256';\n  }\n  return `https://www.gravatar.com/avatar/${hash}?d=identicon`;\n}\n"]},"metadata":{},"sourceType":"module"}