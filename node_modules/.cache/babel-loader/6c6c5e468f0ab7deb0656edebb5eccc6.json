{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/runner/work/watchparty/watchparty/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/runner/work/watchparty/watchparty/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useCallback}from'react';import{Icon,Divider,Radio,Message,Input,Button,Label}from'semantic-ui-react';// import { SignInButton } from '../TopBar/TopBar';\nimport{getCurrentSettings,updateSettings}from'./LocalSettings';import axios from'axios';import{serverPath}from'../../utils';import{PermanentRoomModal}from'../Modal/PermanentRoomModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var SettingsTab=function SettingsTab(_ref){var hide=_ref.hide,user=_ref.user,roomLock=_ref.roomLock,setRoomLock=_ref.setRoomLock,socket=_ref.socket,isSubscriber=_ref.isSubscriber,owner=_ref.owner,vanity=_ref.vanity,setVanity=_ref.setVanity,roomLink=_ref.roomLink,password=_ref.password,setPassword=_ref.setPassword,isChatDisabled=_ref.isChatDisabled,setIsChatDisabled=_ref.setIsChatDisabled,clearChat=_ref.clearChat;var _useState=useState(0),_useState2=_slicedToArray(_useState,2),updateTS=_useState2[0],setUpdateTS=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),permModalOpen=_useState4[0],setPermModalOpen=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),validVanity=_useState6[0],setValidVanity=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),validVanityLoading=_useState8[0],setValidVanityLoading=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),adminSettingsChanged=_useState10[0],setAdminSettingsChanged=_useState10[1];var setRoomState=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var token;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return user===null||user===void 0?void 0:user.getIdToken();case 2:token=_context.sent;socket.emit('CMD:setRoomState',_objectSpread({uid:user===null||user===void 0?void 0:user.uid,token:token},data));case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}(),[socket,user]);var setRoomOwner=useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data){var token;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return user===null||user===void 0?void 0:user.getIdToken();case 2:token=_context2.sent;socket.emit('CMD:setRoomOwner',_objectSpread({uid:user===null||user===void 0?void 0:user.uid,token:token},data));case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}(),[socket,user]);var checkValidVanity=useCallback(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(input){var response,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(input){_context3.next=3;break;}setValidVanity(true);return _context3.abrupt(\"return\");case 3:setValidVanity(false);setValidVanityLoading(true);_context3.next=7;return axios.get(serverPath+'/resolveRoom/'+input);case 7:response=_context3.sent;data=response.data;setValidVanityLoading(false);if(data&&data.vanity&&data.vanity!==roomLink.split('/').slice(-1)[0]){// Already exists and doesn't match current room\nsetValidVanity(false);}else{setValidVanity(true);}case 11:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref4.apply(this,arguments);};}(),[setValidVanity,roomLink]);var lockDisabled=!Boolean(user)||Boolean(roomLock&&roomLock!==(user===null||user===void 0?void 0:user.uid));var permanentDisabled=!Boolean(user)||Boolean(owner&&owner!==(user===null||user===void 0?void 0:user.uid));return/*#__PURE__*/_jsxs(\"div\",{style:{display:hide?'none':'block',color:'white',overflow:'scroll',padding:'8px'},children:[permModalOpen&&/*#__PURE__*/_jsx(PermanentRoomModal,{closeModal:function closeModal(){return setPermModalOpen(false);}}),/*#__PURE__*/_jsx(\"div\",{className:\"sectionHeader\",children:\"Room Settings\"}),!user&&/*#__PURE__*/_jsx(Message,{color:\"yellow\",size:\"tiny\",children:\"You need to be signed in to change these settings.\"}),/*#__PURE__*/_jsx(SettingRow,{icon:roomLock?'lock':'lock open',name:\"Lock Room\",description:\"Only the person who locked the room can control the video.\",checked:Boolean(roomLock),disabled:lockDisabled,onChange:function onChange(_e,data){return setRoomLock(data.checked);}}),/*#__PURE__*/_jsx(SettingRow,{icon:'clock',name:\"Make Room Permanent\",description:'Prevent this room from expiring. This also unlocks additional room features.',helpIcon:/*#__PURE__*/_jsx(Icon,{name:\"help circle\",onClick:function onClick(){return setPermModalOpen(true);},style:{cursor:'pointer'}}),checked:Boolean(owner),disabled:permanentDisabled,onChange:function onChange(_e,data){return setRoomOwner({undo:!data.checked});}}),owner&&owner===(user===null||user===void 0?void 0:user.uid)&&/*#__PURE__*/_jsx(\"div\",{className:\"sectionHeader\",children:\"Admin Settings\"}),owner&&owner===(user===null||user===void 0?void 0:user.uid)&&/*#__PURE__*/_jsx(SettingRow,{icon:'key',name:\"Set Room Password\",description:\"Users must know this password in order to join the room.\",content:/*#__PURE__*/_jsx(Input,{value:password,size:\"mini\",onChange:function onChange(e){setAdminSettingsChanged(true);setPassword(e.target.value);},fluid:true}),disabled:false}),owner&&owner===(user===null||user===void 0?void 0:user.uid)&&/*#__PURE__*/_jsx(SettingRow,{icon:'i cursor',name:\"Disable Chat\",description:\"Prevent users from sending messages in chat.\",checked:Boolean(isChatDisabled),disabled:false,onChange:function onChange(_e,data){setAdminSettingsChanged(true);setIsChatDisabled(Boolean(data.checked));}}),owner&&owner===(user===null||user===void 0?void 0:user.uid)&&/*#__PURE__*/_jsx(SettingRow,{icon:'i delete',name:\"Clear Chat\",description:\"Delete all existing chat messages\",disabled:false,content:/*#__PURE__*/_jsxs(Button,{color:\"red\",icon:true,labelPosition:\"left\",onClick:function onClick(){return clearChat();},children:[/*#__PURE__*/_jsx(Icon,{name:\"delete\"}),\"Delete Messages\"]})}),owner&&owner===(user===null||user===void 0?void 0:user.uid)&&/*#__PURE__*/_jsx(SettingRow,{icon:'linkify',name:\"Set Custom Room URL\",description:\"Set a custom URL for this room. Inappropriate names may be revoked.\",checked:Boolean(roomLock),disabled:!isSubscriber,subOnly:true,content:/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(Input,{value:vanity,disabled:!isSubscriber,onChange:function onChange(e){setAdminSettingsChanged(true);checkValidVanity(e.target.value);setVanity(e.target.value);},label:/*#__PURE__*/_jsx(Label,{children:\"\".concat(window.location.origin,\"/r/\")}),loading:validVanityLoading,fluid:true,size:\"mini\",icon:true,action:validVanity?/*#__PURE__*/_jsx(Icon,{name:\"checkmark\",color:\"green\"}):/*#__PURE__*/_jsx(Icon,{name:\"close\",color:\"red\"})})})}),/*#__PURE__*/_jsx(\"p\",{}),owner&&owner===(user===null||user===void 0?void 0:user.uid)&&/*#__PURE__*/_jsxs(Button,{primary:true,disabled:!validVanity||!adminSettingsChanged,labelPosition:\"left\",icon:true,fluid:true,onClick:function onClick(){setRoomState({vanity:vanity,password:password,isChatDisabled:isChatDisabled});setAdminSettingsChanged(false);},children:[/*#__PURE__*/_jsx(Icon,{name:\"save\"}),\"Save Admin Settings\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"sectionHeader\",children:\"Local Settings\"}),/*#__PURE__*/_jsx(SettingRow,{updateTS:updateTS,icon:\"bell\",name:\"Disable chat notification sound\",description:\"Don't play a sound when a chat message is sent while you're on another tab\",checked:Boolean(getCurrentSettings().disableChatSound),disabled:false,onChange:function onChange(_e,data){updateSettings(JSON.stringify(_objectSpread(_objectSpread({},getCurrentSettings()),{},{disableChatSound:data.checked})));setUpdateTS(Number(new Date()));}})]});};var SettingRow=function SettingRow(_ref5){var icon=_ref5.icon,name=_ref5.name,description=_ref5.description,checked=_ref5.checked,disabled=_ref5.disabled,onChange=_ref5.onChange,content=_ref5.content,subOnly=_ref5.subOnly,helpIcon=_ref5.helpIcon;return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Divider,{inverted:true,horizontal:true}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex'},children:[/*#__PURE__*/_jsx(Icon,{size:\"large\",name:icon}),/*#__PURE__*/_jsxs(\"div\",{children:[name,\" \",helpIcon,subOnly?/*#__PURE__*/_jsx(Label,{size:\"mini\",color:\"orange\",children:\"Subscriber only\"}):null]}),!content&&/*#__PURE__*/_jsx(Radio,{style:{marginLeft:'auto'},toggle:true,checked:checked,disabled:disabled,onChange:onChange})]}),/*#__PURE__*/_jsx(\"div\",{className:\"smallText\",style:{marginBottom:'8px'},children:description}),content]})]});};","map":{"version":3,"sources":["/home/runner/work/watchparty/watchparty/src/components/Settings/SettingsTab.tsx"],"names":["React","useState","useCallback","Icon","Divider","Radio","Message","Input","Button","Label","getCurrentSettings","updateSettings","axios","serverPath","PermanentRoomModal","SettingsTab","hide","user","roomLock","setRoomLock","socket","isSubscriber","owner","vanity","setVanity","roomLink","password","setPassword","isChatDisabled","setIsChatDisabled","clearChat","updateTS","setUpdateTS","permModalOpen","setPermModalOpen","validVanity","setValidVanity","validVanityLoading","setValidVanityLoading","adminSettingsChanged","setAdminSettingsChanged","setRoomState","data","getIdToken","token","emit","uid","setRoomOwner","checkValidVanity","input","get","response","split","slice","lockDisabled","Boolean","permanentDisabled","display","color","overflow","padding","_e","checked","cursor","undo","e","target","value","window","location","origin","disableChatSound","JSON","stringify","Number","Date","SettingRow","icon","name","description","disabled","onChange","content","subOnly","helpIcon","marginLeft","marginBottom"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from 'react';\nimport {\n  Icon,\n  Divider,\n  Radio,\n  CheckboxProps,\n  Message,\n  Input,\n  Button,\n  Label,\n} from 'semantic-ui-react';\n// import { SignInButton } from '../TopBar/TopBar';\nimport { getCurrentSettings, updateSettings } from './LocalSettings';\nimport axios from 'axios';\nimport { serverPath } from '../../utils';\nimport { PermanentRoomModal } from '../Modal/PermanentRoomModal';\nimport firebase from 'firebase/compat/app';\nimport { Socket } from 'socket.io-client';\n\ninterface SettingsTabProps {\n  hide: boolean;\n  user: firebase.User | undefined;\n  roomLock: string;\n  setRoomLock: Function;\n  socket: Socket;\n  isSubscriber: boolean;\n  roomId: string;\n  owner: string | undefined;\n  setOwner: Function;\n  vanity: string | undefined;\n  setVanity: Function;\n  roomLink: string;\n  password: string | undefined;\n  setPassword: Function;\n  isChatDisabled: boolean;\n  setIsChatDisabled: Function;\n  clearChat: Function;\n}\n\nexport const SettingsTab = ({\n  hide,\n  user,\n  roomLock,\n  setRoomLock,\n  socket,\n  isSubscriber,\n  owner,\n  vanity,\n  setVanity,\n  roomLink,\n  password,\n  setPassword,\n  isChatDisabled,\n  setIsChatDisabled,\n  clearChat,\n}: SettingsTabProps) => {\n  const [updateTS, setUpdateTS] = useState(0);\n  const [permModalOpen, setPermModalOpen] = useState(false);\n  const [validVanity, setValidVanity] = useState(true);\n  const [validVanityLoading, setValidVanityLoading] = useState(false);\n  const [adminSettingsChanged, setAdminSettingsChanged] = useState(false);\n\n  const setRoomState = useCallback(\n    async (data: any) => {\n      const token = await user?.getIdToken();\n      socket.emit('CMD:setRoomState', {\n        uid: user?.uid,\n        token,\n        ...data,\n      });\n    },\n    [socket, user]\n  );\n  const setRoomOwner = useCallback(\n    async (data: any) => {\n      const token = await user?.getIdToken();\n      socket.emit('CMD:setRoomOwner', {\n        uid: user?.uid,\n        token,\n        ...data,\n      });\n    },\n    [socket, user]\n  );\n  const checkValidVanity = useCallback(\n    async (input: string) => {\n      if (!input) {\n        setValidVanity(true);\n        return;\n      }\n      setValidVanity(false);\n      setValidVanityLoading(true);\n      const response = await axios.get(serverPath + '/resolveRoom/' + input);\n      const data = response.data;\n      setValidVanityLoading(false);\n      if (\n        data &&\n        data.vanity &&\n        data.vanity !== roomLink.split('/').slice(-1)[0]\n      ) {\n        // Already exists and doesn't match current room\n        setValidVanity(false);\n      } else {\n        setValidVanity(true);\n      }\n    },\n    [setValidVanity, roomLink]\n  );\n  const lockDisabled =\n    !Boolean(user) || Boolean(roomLock && roomLock !== user?.uid);\n  const permanentDisabled =\n    !Boolean(user) || Boolean(owner && owner !== user?.uid);\n\n  return (\n    <div\n      style={{\n        display: hide ? 'none' : 'block',\n        color: 'white',\n        overflow: 'scroll',\n        padding: '8px',\n      }}\n    >\n      {permModalOpen && (\n        <PermanentRoomModal\n          closeModal={() => setPermModalOpen(false)}\n        ></PermanentRoomModal>\n      )}\n      <div className=\"sectionHeader\">Room Settings</div>\n      {!user && (\n        <Message color=\"yellow\" size=\"tiny\">\n          You need to be signed in to change these settings.\n        </Message>\n      )}\n      <SettingRow\n        icon={roomLock ? 'lock' : 'lock open'}\n        name={`Lock Room`}\n        description=\"Only the person who locked the room can control the video.\"\n        checked={Boolean(roomLock)}\n        disabled={lockDisabled}\n        onChange={(_e, data) => setRoomLock(data.checked)}\n      />\n      {\n        <SettingRow\n          icon={'clock'}\n          name={`Make Room Permanent`}\n          description={\n            'Prevent this room from expiring. This also unlocks additional room features.'\n          }\n          helpIcon={\n            <Icon\n              name=\"help circle\"\n              onClick={() => setPermModalOpen(true)}\n              style={{ cursor: 'pointer' }}\n            ></Icon>\n          }\n          checked={Boolean(owner)}\n          disabled={permanentDisabled}\n          onChange={(_e, data) => setRoomOwner({ undo: !data.checked })}\n        />\n      }\n      {owner && owner === user?.uid && (\n        <div className=\"sectionHeader\">Admin Settings</div>\n      )}\n      {owner && owner === user?.uid && (\n        <SettingRow\n          icon={'key'}\n          name={`Set Room Password`}\n          description=\"Users must know this password in order to join the room.\"\n          content={\n            <Input\n              value={password}\n              size=\"mini\"\n              onChange={(e) => {\n                setAdminSettingsChanged(true);\n                setPassword(e.target.value);\n              }}\n              fluid\n            />\n          }\n          disabled={false}\n        />\n      )}\n      {owner && owner === user?.uid && (\n        <SettingRow\n          icon={'i cursor'}\n          name={`Disable Chat`}\n          description=\"Prevent users from sending messages in chat.\"\n          checked={Boolean(isChatDisabled)}\n          disabled={false}\n          onChange={(_e, data) => {\n            setAdminSettingsChanged(true);\n            setIsChatDisabled(Boolean(data.checked));\n          }}\n        />\n      )}\n      {owner && owner === user?.uid && (\n        <SettingRow\n          icon={'i delete'}\n          name={`Clear Chat`}\n          description=\"Delete all existing chat messages\"\n          disabled={false}\n          content={\n            <Button\n              color=\"red\"\n              icon\n              labelPosition=\"left\"\n              onClick={() => clearChat()}\n            >\n              <Icon name=\"delete\" />\n              Delete Messages\n            </Button>\n          }\n        />\n      )}\n      {owner && owner === user?.uid && (\n        <SettingRow\n          icon={'linkify'}\n          name={`Set Custom Room URL`}\n          description=\"Set a custom URL for this room. Inappropriate names may be revoked.\"\n          checked={Boolean(roomLock)}\n          disabled={!isSubscriber}\n          subOnly={true}\n          content={\n            <React.Fragment>\n              <Input\n                value={vanity}\n                disabled={!isSubscriber}\n                onChange={(e) => {\n                  setAdminSettingsChanged(true);\n                  checkValidVanity(e.target.value);\n                  setVanity(e.target.value);\n                }}\n                label={<Label>{`${window.location.origin}/r/`}</Label>}\n                loading={validVanityLoading}\n                fluid\n                size=\"mini\"\n                icon\n                action={\n                  validVanity ? (\n                    <Icon name=\"checkmark\" color=\"green\" />\n                  ) : (\n                    <Icon name=\"close\" color=\"red\" />\n                  )\n                }\n              ></Input>\n            </React.Fragment>\n          }\n        />\n      )}\n      <p />\n      {owner && owner === user?.uid && (\n        <Button\n          primary\n          disabled={!validVanity || !adminSettingsChanged}\n          labelPosition=\"left\"\n          icon\n          fluid\n          onClick={() => {\n            setRoomState({\n              vanity: vanity,\n              password: password,\n              isChatDisabled: isChatDisabled,\n            });\n            setAdminSettingsChanged(false);\n          }}\n        >\n          <Icon name=\"save\" />\n          Save Admin Settings\n        </Button>\n      )}\n      {/* MEDIA_PATH */}\n      <div className=\"sectionHeader\">Local Settings</div>\n      <SettingRow\n        updateTS={updateTS}\n        icon=\"bell\"\n        name=\"Disable chat notification sound\"\n        description=\"Don't play a sound when a chat message is sent while you're on another tab\"\n        checked={Boolean(getCurrentSettings().disableChatSound)}\n        disabled={false}\n        onChange={(_e, data) => {\n          updateSettings(\n            JSON.stringify({\n              ...getCurrentSettings(),\n              disableChatSound: data.checked,\n            })\n          );\n          setUpdateTS(Number(new Date()));\n        }}\n      />\n    </div>\n  );\n};\n\nconst SettingRow = ({\n  icon,\n  name,\n  description,\n  checked,\n  disabled,\n  onChange,\n  content,\n  subOnly,\n  helpIcon,\n}: {\n  icon: string;\n  name: string;\n  description?: React.ReactNode;\n  checked?: boolean;\n  disabled: boolean;\n  updateTS?: number;\n  onChange?: (e: React.FormEvent, data: CheckboxProps) => void;\n  content?: React.ReactNode;\n  subOnly?: boolean;\n  helpIcon?: React.ReactNode;\n}) => {\n  return (\n    <React.Fragment>\n      <Divider inverted horizontal />\n      <div>\n        <div style={{ display: 'flex' }}>\n          <Icon size=\"large\" name={icon as any} />\n          <div>\n            {name} {helpIcon}\n            {subOnly ? (\n              <Label size=\"mini\" color=\"orange\">\n                Subscriber only\n              </Label>\n            ) : null}\n          </div>\n          {!content && (\n            <Radio\n              style={{ marginLeft: 'auto' }}\n              toggle\n              checked={checked}\n              disabled={disabled}\n              onChange={onChange}\n            />\n          )}\n        </div>\n        <div className=\"smallText\" style={{ marginBottom: '8px' }}>\n          {description}\n        </div>\n        {content}\n      </div>\n    </React.Fragment>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}